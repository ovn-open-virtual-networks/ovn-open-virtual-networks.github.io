<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="简介
关于阿里云香港Region可用区C服务中断事件的说明 2022年12月18日阿里云香港可用区C因机房制冷系统出现故障，导致该可用区服务不可用。
影响
具体受影响服务包括：云服务器ECS、云数据库、存储产品（对象存储、表格存储等）、云网络产品（全球加速、NAT网关、VPN网关等）等云产品使用。
根因
机房制冷系统出现异常，导致服务器不可用。
故障修复


08:56 阿里云监控到香港Region可用区C机房包间通道温控告警，阿里云工程师介入应急处理，通知机房服务商进行现场排查。
09:01 阿里云监控到该机房多个包间温升告警，此时工程师排查到冷机异常。
09:09 机房服务商按应急预案对异常冷机进行4&#43;4主备切换以及重启，但操作失败，冷水机组无法恢复正常。
09:17 依照故障处理流程，启动制冷异常应急预案，进行辅助散热和应急通风。尝试对冷机控制系统逐个进行隔离和手工恢复操作，但发现无法稳定运行，联系冷机设备供应商到现场排查。此时，由于高温原因，部分服务器开始受到影响。
10:30开始 为避免可能出现的高温消防问题，阿里云工程师陆续对整个机房计算、存储、网络、数据库、大数据集群进行降载处理。期间，继续多次对冷机设备进行操作，但均不能保持稳定运行。
12:30 冷机设备供应商到场，在多方工程师诊断下，对冷塔、冷却水管路及冷机冷凝器进行手工补水排气操作，但系统仍然无法保持稳定运行。阿里云工程师对部分高温包间启动服务器关机操作。
14:47 冷机设备供应商对设备问题排查遇到困难，其中一个包间因高温触发了强制消防喷淋。
15:20 冷机设备商工程师现场手工调整配置，冷机群控解锁完成并独立运行，第1台冷机恢复正常，温度开始下降。工程师随后继续通过相同方法对其他冷机进行操作。
18:55 4台冷机恢复到正常制冷量。
19:02 分批启动服务器，并持续观察温升情况。
19:47 机房温度趋于稳定。同时，阿里云工程师开始进行服务启动恢复，并进行必要的数据完整性检查。
21:36 大部分机房包间服务器陆续启动并完成检查，机房温度稳定。其中一个包间因消防喷淋启动，未进行服务器上电。因为保持数据的完整性至关重要，工程师对这个包间的服务器进行了仔细的数据安全检查，这里花费了一些必要的时间。
22:50 数据检查以及风险评估完成，最后一个包间依据安全性逐步进行供电恢复和服务器启动。


预防措施

冷机系统故障恢复时间过长

原因分析：机房冷却系统缺水进气形成气阻，影响水路循环导致4台主冷机服务异常，启动4台备冷机时因主备共用的水路循环系统气阻导致启动失败。水盘补水后，因机房冷却系统的群控逻辑，无法单台独立启动冷机，手工修改冷机配置，将冷机从群控调整为独立运行后，陆续启动冷机，影响了冷却系统的恢复时长。整个过程中，原因定位耗时3小时34分钟，补水排气耗时2小时57分钟，解锁群控逻辑启动4台冷机耗时3小时32分钟。
改进措施：全面检查机房基础设施管控系统，在监控数据采集层面，扩大覆盖度，提升精细度，提高对故障的排查和定位速度；在设施管控逻辑层面，确保系统自动切换逻辑符合预期，同时保证手工切换的准确性，防止内部状态死锁从而影响故障的恢复。



现场处置不及时导致触发消防喷淋

原因分析：随着机房冷却系统失效，包间温度逐渐升高，导致一机房包间温度达到临界值触发消防系统喷淋，电源柜和多列机柜进水，部分机器硬件损坏，增加了后续恢复难度和时长。
改进措施：加强机房服务商管理，梳理机房温升预案及标准化执行动作，明确温升场景下的业务侧关机和机房强制关电的预案，力求更简单有效，并通过常态化演练强化执行。



客户在香港地域新购ECS等管控操作失败

原因分析：ECS管控系统为B、C可用区双机房容灾，C可用区故障后由B可用区对外提供服务，由于大量可用区C的客户在香港其他可用区新购实例，同时可用区C的ECS实例拉起恢复动作引入的流量，导致可用区 B 管控服务资源不足。新扩容的ECS管控系统启动时依赖的中间件服务部署在可用区C机房，导致较长时间内无法扩容。ECS管控依赖的自定义镜像数据服务，依赖可用区C的单AZ冗余版本的OSS服务，导致客户新购实例后出现启动失败的现象。
改进措施：全网巡检，整体优化多AZ产品高可用设计，避免出现依赖OSS单AZ和中间件单AZ的问题。加强阿里云管控平面的容灾演练，进一步提升云产品高可用容灾逃逸能力。


补充

阿里云地域和可用区概念:

地域 地域指数据中心所在的地理区域，通常按照数据中心所在的城市划分。例如，华北2（北京）地域表示数据中心所在的城市是北京。
可用区 可用区是指在同一地域内，电力和网络互相独立的物理区域。例如，华北2（北京）地域支持12个可用区，包括北京 可用区A和北京 可用区B等。同一可用区内实例之间的网络延时更小，其用户访问速度更快。在同一地域内，可用区与可用区之间内网互通。各可用区之间可以实现故障隔离，即如果一个可用区出现故障，则不会影响其他可用区的正常运行。是否将实例放在同一可用区内，主要取决于您的应用对容灾能力和网络延时的要求。


">  

  <title>
    
      2022-12-18 阿里云香港机房服务中断故障解析复盘
    
  </title>

  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.d1870d957d0da98d44f401b7105907bd4ea27ed98759342e31f0f02edb9d0da2c2850837407e119177488074c0fd7426d49d90a5f6dfd1e936187d74d21f8589.css" integrity="sha512-0YcNlX0NqY1E9AG3EFkHvU6iftmHWTQuMfDwLtudDaLChQg3QH4RkXdIgHTA/XQm1J2Qpfbf0ek2GH100h&#43;FiQ==" />
  
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
                <div class="post-meta">
                    <a href="/">..</a>

                    <p>
                        <time datetime="2024-04-01 21:17:43 -0500 -0500">
                            2024-04-01
                        </time>
                    </p>
                </div>

<article>
    <h1>2022-12-18 阿里云香港机房服务中断故障解析复盘</h1>

    
        <aside  class="toc" >
            <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#影响">影响</a></li>
    <li><a href="#根因">根因</a></li>
    <li><a href="#故障修复">故障修复</a></li>
    <li><a href="#预防措施">预防措施</a></li>
    <li><a href="#补充">补充</a></li>
  </ul>
</nav>
        </aside>
    

    <h2 id="简介">简介</h2>
<p><a href="https://www.aliyun.com/noticelist/articleid/1061819219.html">关于阿里云香港Region可用区C服务中断事件的说明</a> 2022年12月18日阿里云香港可用区C因机房制冷系统出现故障，导致该可用区服务不可用。</p>
<h2 id="影响">影响</h2>
<p>具体受影响服务包括：云服务器ECS、云数据库、存储产品（对象存储、表格存储等）、云网络产品（全球加速、NAT网关、VPN网关等）等云产品使用。</p>
<h2 id="根因">根因</h2>
<p>机房制冷系统出现异常，导致服务器不可用。</p>
<h2 id="故障修复">故障修复</h2>
<blockquote>
<ul>
<li>08:56 阿里云监控到香港Region可用区C机房包间通道温控告警，阿里云工程师介入应急处理，通知机房服务商进行现场排查。</li>
<li>09:01 阿里云监控到该机房多个包间温升告警，此时工程师排查到冷机异常。</li>
<li>09:09 机房服务商按应急预案对异常冷机进行4+4主备切换以及重启，但操作失败，冷水机组无法恢复正常。</li>
<li>09:17 依照故障处理流程，启动制冷异常应急预案，进行辅助散热和应急通风。尝试对冷机控制系统逐个进行隔离和手工恢复操作，但发现无法稳定运行，联系冷机设备供应商到现场排查。此时，由于高温原因，部分服务器开始受到影响。</li>
<li>10:30开始 为避免可能出现的高温消防问题，阿里云工程师陆续对整个机房计算、存储、网络、数据库、大数据集群进行降载处理。期间，继续多次对冷机设备进行操作，但均不能保持稳定运行。</li>
<li>12:30 冷机设备供应商到场，在多方工程师诊断下，对冷塔、冷却水管路及冷机冷凝器进行手工补水排气操作，但系统仍然无法保持稳定运行。阿里云工程师对部分高温包间启动服务器关机操作。</li>
<li>14:47 冷机设备供应商对设备问题排查遇到困难，其中一个包间因高温触发了强制消防喷淋。</li>
<li>15:20 冷机设备商工程师现场手工调整配置，冷机群控解锁完成并独立运行，第1台冷机恢复正常，温度开始下降。工程师随后继续通过相同方法对其他冷机进行操作。</li>
<li>18:55 4台冷机恢复到正常制冷量。</li>
<li>19:02 分批启动服务器，并持续观察温升情况。</li>
<li>19:47 机房温度趋于稳定。同时，阿里云工程师开始进行服务启动恢复，并进行必要的数据完整性检查。</li>
<li>21:36 大部分机房包间服务器陆续启动并完成检查，机房温度稳定。其中一个包间因消防喷淋启动，未进行服务器上电。因为保持数据的完整性至关重要，工程师对这个包间的服务器进行了仔细的数据安全检查，这里花费了一些必要的时间。</li>
<li>22:50 数据检查以及风险评估完成，最后一个包间依据安全性逐步进行供电恢复和服务器启动。</li>
</ul>
</blockquote>
<h2 id="预防措施">预防措施</h2>
<blockquote>
<p><strong>冷机系统故障恢复时间过长</strong></p>
<ol>
<li><strong>原因分析</strong>：机房冷却系统缺水进气形成气阻，影响水路循环导致4台主冷机服务异常，启动4台备冷机时因主备共用的水路循环系统气阻导致启动失败。水盘补水后，因机房冷却系统的群控逻辑，无法单台独立启动冷机，手工修改冷机配置，将冷机从群控调整为独立运行后，陆续启动冷机，影响了冷却系统的恢复时长。整个过程中，原因定位耗时3小时34分钟，补水排气耗时2小时57分钟，解锁群控逻辑启动4台冷机耗时3小时32分钟。</li>
<li><strong>改进措施</strong>：全面检查机房基础设施管控系统，在监控数据采集层面，扩大覆盖度，提升精细度，提高对故障的排查和定位速度；在设施管控逻辑层面，确保系统自动切换逻辑符合预期，同时保证手工切换的准确性，防止内部状态死锁从而影响故障的恢复。</li>
</ol>
</blockquote>
<blockquote>
<p><strong>现场处置不及时导致触发消防喷淋</strong></p>
<ol>
<li><strong>原因分析</strong>：随着机房冷却系统失效，包间温度逐渐升高，导致一机房包间温度达到临界值触发消防系统喷淋，电源柜和多列机柜进水，部分机器硬件损坏，增加了后续恢复难度和时长。</li>
<li><strong>改进措施</strong>：加强机房服务商管理，梳理机房温升预案及标准化执行动作，明确温升场景下的业务侧关机和机房强制关电的预案，力求更简单有效，并通过常态化演练强化执行。</li>
</ol>
</blockquote>
<blockquote>
<p><strong>客户在香港地域新购ECS等管控操作失败</strong></p>
<ol>
<li><strong>原因分析</strong>：ECS管控系统为B、C可用区双机房容灾，C可用区故障后由B可用区对外提供服务，由于大量可用区C的客户在香港其他可用区新购实例，同时可用区C的ECS实例拉起恢复动作引入的流量，导致可用区 B 管控服务资源不足。新扩容的ECS管控系统启动时依赖的中间件服务部署在可用区C机房，导致较长时间内无法扩容。ECS管控依赖的自定义镜像数据服务，依赖可用区C的单AZ冗余版本的OSS服务，导致客户新购实例后出现启动失败的现象。</li>
<li><strong>改进措施</strong>：全网巡检，整体优化多AZ产品高可用设计，避免出现依赖OSS单AZ和中间件单AZ的问题。加强阿里云管控平面的容灾演练，进一步提升云产品高可用容灾逃逸能力。</li>
</ol>
</blockquote>
<h2 id="补充">补充</h2>
<blockquote>
<p><a href="https://help.aliyun.com/document_detail/40654.html">阿里云地域和可用区概念</a>:</p>
<ol>
<li><strong>地域</strong> 地域指数据中心所在的地理区域，通常按照数据中心所在的城市划分。例如，华北2（北京）地域表示数据中心所在的城市是北京。</li>
<li><strong>可用区</strong> 可用区是指在同一地域内，电力和网络互相独立的物理区域。例如，华北2（北京）地域支持12个可用区，包括北京 可用区A和北京 可用区B等。同一可用区内实例之间的网络延时更小，其用户访问速度更快。在同一地域内，可用区与可用区之间内网互通。各可用区之间可以实现故障隔离，即如果一个可用区出现故障，则不会影响其他可用区的正常运行。是否将实例放在同一可用区内，主要取决于您的应用对容灾能力和网络延时的要求。</li>
</ol>
</blockquote>
<p><img src="/2022-12-18-alibaba-region-az.png" alt=""></p>

</article>
<div class="postlink">
	<p><strong>本文链接地址: </strong><a href="">《2022-12-18 阿里云香港机房服务中断故障解析复盘》</a><p>
</div>
</div>
        </main>
    </body></html>
